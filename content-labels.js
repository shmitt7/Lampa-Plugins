(function(){'use strict';if(window.content_labels_plugin_ready)return;window.content_labels_plugin_ready=true;const processedCards=new WeakSet();const processedLabels=new WeakSet();let observer=null;let debounceTimeout=null;let detailPageCache={element:null,genreIds:null};let lastProcessTime=0;function getContentType(genreIds,isMovie){if(!genreIds||genreIds.length===0)return isMovie?'Фильм':'Сериал';if(genreIds.includes(10763))return'Новости';if(genreIds.includes(10764))return'Реалити';if(genreIds.includes(10767))return'Ток-шоу';if(genreIds.includes(99))return'Доку';if(genreIds.includes(16))return'Мульт';return isMovie?'Фильм':'Сериал';}function checkAnime(element){const card=element.closest('.card');return card?.card_data?.original_language==='ja';}function getGenreIdsForCard(element){const card=element.closest('.card');return card?.card_data?.genre_ids||null;}function getGenreIdsForDetailPage(){const detailElement=document.querySelector('.full-start-new__details, .full-start__details');if(detailPageCache.element===detailElement&&detailPageCache.genreIds)return detailPageCache.genreIds;if(!detailElement){detailPageCache.element=null;detailPageCache.genreIds=null;return null;}const genreText=detailElement.textContent.toLowerCase();const genreIds=[];if(genreText.includes('новости')||genreText.includes('news'))genreIds.push(10763);if(genreText.includes('реалити')||genreText.includes('reality'))genreIds.push(10764);if(genreText.includes('ток-шоу')||genreText.includes('talk'))genreIds.push(10767);if(genreText.includes('документальный')||genreText.includes('documentary'))genreIds.push(99);if(genreText.includes('мультфильм')||genreText.includes('animation'))genreIds.push(16);detailPageCache.element=detailElement;detailPageCache.genreIds=genreIds.length?genreIds:null;return detailPageCache.genreIds;}function processCard(card){if(processedCards.has(card)||card.querySelector('.card__type'))return;const cardData=card.card_data;if(!cardData||cardData.original_name||cardData.name)return;const viewElem=card.querySelector('.card__view');if(!viewElem)return;const typeElem=document.createElement('div');typeElem.className='card__type';typeElem.textContent='MOVIE';viewElem.appendChild(typeElem);processedCards.add(card);}function processDetailPage(){const fullStart=document.querySelector('.full-start-new, .full-start');if(!fullStart)return;const poster=fullStart.querySelector('.full-start-new__poster, .full-start__poster');if(!poster||poster.querySelector('.card__type'))return;if(fullStart.classList.contains('card--tv')||poster.classList.contains('card--tv'))return;const typeElem=document.createElement('div');typeElem.className='card__type';typeElem.textContent='MOVIE';poster.appendChild(typeElem);}function processLabel(element){if(processedLabels.has(element))return;const originalText=element.textContent;if(originalText!=='TV'&&originalText!=='MOVIE')return;const isMovie=originalText==='MOVIE';const isDetailPage=element.closest('.full-start-new, .full-start');const genreIds=isDetailPage?getGenreIdsForDetailPage():getGenreIdsForCard(element);const isAnime=checkAnime(element);element.textContent=isAnime?'Аниме':getContentType(genreIds,isMovie);element.classList.remove('card__type--movie','card__type--tv');element.classList.add(isMovie?'card__type--movie':'card__type--tv');processedLabels.add(element);}function handleMutations(){const now=Date.now();if(now-lastProcessTime<50)return;lastProcessTime=now;const newCards=document.querySelectorAll('.card:not([data-processed])');newCards.forEach(card=>{card.setAttribute('data-processed','true');processCard(card);});const newLabels=document.querySelectorAll('.card__type:not([data-label-processed])');newLabels.forEach(label=>{label.setAttribute('data-label-processed','true');processLabel(label);});processDetailPage();}function initPlugin(){if(!document.getElementById('content-labels-style')){const style=document.createElement('style');style.id='content-labels-style';style.textContent=`.card__type--tv{background-color:#f44336!important;color:white!important}.card__type--movie{background-color:#1565C0!important;color:white!important}`;document.head.appendChild(style);}handleMutations();observer=new MutationObserver(()=>{clearTimeout(debounceTimeout);debounceTimeout=setTimeout(handleMutations,150);});observer.observe(document.body,{childList:true,subtree:true});}function cleanup(){if(observer){observer.disconnect();observer=null;}clearTimeout(debounceTimeout);processedCards.clear?.();processedLabels.clear?.();detailPageCache.element=null;detailPageCache.genreIds=null;}if(window.appready){initPlugin();}else if(typeof window.Lampa!=='undefined'&&window.Lampa.Listener){window.Lampa.Listener.follow('app',(e)=>{if(e.type==='ready')initPlugin();else if(e.type==='destroy')cleanup();});}else{console.warn('Lampa not found, plugin cannot initialize');}})();
